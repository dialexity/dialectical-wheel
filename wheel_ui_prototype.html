<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Win-Win Wheel</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #f7f7f7;
            font-family: 'Arial Rounded MT Bold', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #fff;
            border-bottom: 1px solid #ddd;
            padding: 0.5em 1em;
            height: 48px;
        }
        .header .icon {
            font-size: 1.5em;
            color: #222;
            background: none;
            border: none;
            padding: 0 0.3em;
            cursor: pointer;
        }
        .header-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #222;
        }
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.5em 0.5em 2em 0.5em;
        }
        .wheel-container {
            width: 100vw;
            max-width: 100vw;
            max-height: 100%;
        }
        .wheel-svg {
            width: 100vw;
            height: 100vw;
            max-width: 100vw;
            max-height: 100%;
            display: block;
        }
        .bottom-bar {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            background: #fff;
            border-top: 1px solid #ddd;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0.5em 0;
            z-index: 10;
        }
        .bottom-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 1.1em;
            color: #0074d9;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5em 1em;
        }
        .bottom-btn svg {
            margin-bottom: 0.2em;
        }
        @media (max-width: 500px) {
            .wheel-container {
                width: 100vw;
                max-width: 100vw;
            }
            .wheel-svg {
                width: 100vw;
                height: 100vw;
                max-width: 100vw;
                max-height: 100vw;
            }
        }
        .record {
            width: 100%;
            height: 100%;
            cursor: grab;
            touch-action: none;
        }
        
        /* New styles for clickable slices */
        .clickable-slice {
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            cursor: pointer;
            fill: transparent;
            stroke: transparent;
            stroke-width: 2;
        }
        .clickable-slice:hover {
            stroke: rgba(0, 116, 217, 0.3);
            fill: rgba(0, 116, 217, 0.1);
        }
        
        .slice-boundary {
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .controls-overlay {
            position: absolute;
            top: 60px;
            left: 20px;
            color: #333;
            font-size: 12px;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px;
            border-radius: 4px;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <button class="icon" aria-label="Menu">&#9776;</button>
        <span class="header-title">Win-Win</span>
        <div>
            <button class="icon" aria-label="Help">&#x2753;</button>
            <button class="icon" aria-label="Zoom">&#128269;</button>
            <button class="icon" aria-label="Close">&#10006;</button>
        </div>
    </div>
    <div class="main-content">
        <div class="controls-overlay">
            Drag to rotate • Pinch to zoom • Click slices to enlarge
        </div>
        <div class="wheel-container">
            <svg class="wheel-svg" viewBox="0 0 400 400">
                <g class="record">
                    <defs>
                        <path id="arc0" d="M 260.0,200.0 A 60.0,60.0 0 0,1 242.42640687119285,242.42640687119285" fill="none"/>
                        <path id="arc1" d="M 289.0,200.0 A 88.99999999999999,88.99999999999999 0 0,1 262.9325035256027,262.9325035256027" fill="none"/>
                        <path id="arc2" d="M 301.0,200.0 A 100.99999999999999,100.99999999999999 0 0,1 271.4177848998413,271.4177848998413" fill="none"/>
                        <path id="arc3" d="M 322.0,200.0 A 121.99999999999997,121.99999999999997 0 0,1 286.2670273047588,286.26702730475876" fill="none"/>
                        <path id="arc4" d="M 338.0,200.0 A 137.99999999999997,137.99999999999997 0 0,1 297.58073580374355,297.58073580374355" fill="none"/>
                        <path id="arc5" d="M 242.42640687119285,242.42640687119285 A 60.0,60.0 0 0,1 200.0,260.0" fill="none"/>
                        <path id="arc6" d="M 262.9325035256027,262.9325035256027 A 88.99999999999999,88.99999999999999 0 0,1 200.0,289.0" fill="none"/>
                        <path id="arc7" d="M 271.4177848998413,271.4177848998413 A 100.99999999999999,100.99999999999999 0 0,1 200.0,301.0" fill="none"/>
                        <path id="arc8" d="M 286.2670273047588,286.26702730475876 A 121.99999999999997,121.99999999999997 0 0,1 200.0,322.0" fill="none"/>
                        <path id="arc9" d="M 297.58073580374355,297.58073580374355 A 137.99999999999997,137.99999999999997 0 0,1 200.0,338.0" fill="none"/>
                        <path id="arc10" d="M 200.0,260.0 A 60.0,60.0 0 0,1 157.57359312880715,242.42640687119285" fill="none"/>
                        <path id="arc11" d="M 200.0,289.0 A 88.99999999999999,88.99999999999999 0 0,1 137.06749647439727,262.9325035256027" fill="none"/>
                        <path id="arc12" d="M 200.0,301.0 A 100.99999999999999,100.99999999999999 0 0,1 128.58221510015872,271.4177848998413" fill="none"/>
                        <path id="arc13" d="M 200.0,322.0 A 121.99999999999997,121.99999999999997 0 0,1 113.73297269524123,286.2670273047588" fill="none"/>
                        <path id="arc14" d="M 200.0,338.0 A 137.99999999999997,137.99999999999997 0 0,1 102.41926419625646,297.58073580374355" fill="none"/>
                        <path id="arc15" d="M 157.57359312880715,242.42640687119285 A 60.0,60.0 0 0,1 140.0,200.0" fill="none"/>
                        <path id="arc16" d="M 137.06749647439727,262.9325035256027 A 88.99999999999999,88.99999999999999 0 0,1 111.00000000000001,200.0" fill="none"/>
                        <path id="arc17" d="M 128.58221510015872,271.4177848998413 A 100.99999999999999,100.99999999999999 0 0,1 99.00000000000001,200.0" fill="none"/>
                        <path id="arc18" d="M 113.73297269524123,286.2670273047588 A 121.99999999999997,121.99999999999997 0 0,1 78.00000000000003,200.00000000000003" fill="none"/>
                        <path id="arc19" d="M 102.41926419625646,297.58073580374355 A 137.99999999999997,137.99999999999997 0 0,1 62.00000000000003,200.00000000000003" fill="none"/>
                        <path id="arc20" d="M 140.0,200.0 A 60.0,60.0 0 0,1 157.57359312880715,157.57359312880715" fill="none"/>
                        <path id="arc21" d="M 111.00000000000001,200.0 A 88.99999999999999,88.99999999999999 0 0,1 137.06749647439727,137.06749647439727" fill="none"/>
                        <path id="arc22" d="M 99.00000000000001,200.0 A 100.99999999999999,100.99999999999999 0 0,1 128.5822151001587,128.58221510015872" fill="none"/>
                        <path id="arc23" d="M 78.00000000000003,200.00000000000003 A 121.99999999999997,121.99999999999997 0 0,1 113.7329726952412,113.73297269524123" fill="none"/>
                        <path id="arc24" d="M 62.00000000000003,200.00000000000003 A 137.99999999999997,137.99999999999997 0 0,1 102.41926419625644,102.41926419625646" fill="none"/>
                        <path id="arc25" d="M 157.57359312880715,157.57359312880715 A 60.0,60.0 0 0,1 200.0,140.0" fill="none"/>
                        <path id="arc26" d="M 137.06749647439727,137.06749647439727 A 88.99999999999999,88.99999999999999 0 0,1 199.99999999999997,111.00000000000001" fill="none"/>
                        <path id="arc27" d="M 128.5822151001587,128.58221510015872 A 100.99999999999999,100.99999999999999 0 0,1 199.99999999999997,99.00000000000001" fill="none"/>
                        <path id="arc28" d="M 113.7329726952412,113.73297269524123 A 121.99999999999997,121.99999999999997 0 0,1 199.99999999999997,78.00000000000003" fill="none"/>
                        <path id="arc29" d="M 102.41926419625644,102.41926419625646 A 137.99999999999997,137.99999999999997 0 0,1 199.99999999999997,62.00000000000003" fill="none"/>
                        <path id="arc30" d="M 200.0,140.0 A 60.0,60.0 0 0,1 242.42640687119285,157.57359312880715" fill="none"/>
                        <path id="arc31" d="M 199.99999999999997,111.00000000000001 A 88.99999999999999,88.99999999999999 0 0,1 262.9325035256027,137.06749647439727" fill="none"/>
                        <path id="arc32" d="M 199.99999999999997,99.00000000000001 A 100.99999999999999,100.99999999999999 0 0,1 271.41778489984125,128.5822151001587" fill="none"/>
                        <path id="arc33" d="M 199.99999999999997,78.00000000000003 A 121.99999999999997,121.99999999999997 0 0,1 286.26702730475876,113.7329726952412" fill="none"/>
                        <path id="arc34" d="M 199.99999999999997,62.00000000000003 A 137.99999999999997,137.99999999999997 0 0,1 297.5807358037435,102.41926419625644" fill="none"/>
                        <path id="arc35" d="M 242.42640687119285,157.57359312880715 A 60.0,60.0 0 0,1 260.0,199.99999999999997" fill="none"/>
                        <path id="arc36" d="M 262.9325035256027,137.06749647439727 A 88.99999999999999,88.99999999999999 0 0,1 289.0,199.99999999999997" fill="none"/>
                        <path id="arc37" d="M 271.41778489984125,128.5822151001587 A 100.99999999999999,100.99999999999999 0 0,1 301.0,199.99999999999997" fill="none"/>
                        <path id="arc38" d="M 286.26702730475876,113.7329726952412 A 121.99999999999997,121.99999999999997 0 0,1 322.0,199.99999999999997" fill="none"/>
                        <path id="arc39" d="M 297.5807358037435,102.41926419625644 A 137.99999999999997,137.99999999999997 0 0,1 338.0,199.99999999999997" fill="none"/>
                        </defs>
                        <g class="record">
                        <circle cx="200" cy="200" r="149.99999999999997" fill="#F9C6CC"/>
                        <circle cx="200" cy="200" r="114.99999999999999" fill="#FFFFFF"/>
                        <circle cx="200" cy="200" r="80.0" fill="#C6E5B3"/>
                        <g id="clickable-slices">
                        <path class="clickable-slice" data-slice="0" d="M 200,200 L 350.0,200.0 A 150,150 0 0,1 306.06601717798213,306.06601717798213 Z"/>
                        <path class="clickable-slice" data-slice="1" d="M 200,200 L 306.06601717798213,306.06601717798213 A 150,150 0 0,1 200.0,350.0 Z"/>
                        <path class="clickable-slice" data-slice="2" d="M 200,200 L 200.0,350.0 A 150,150 0 0,1 93.93398282201788,306.06601717798213 Z"/>
                        <path class="clickable-slice" data-slice="3" d="M 200,200 L 93.93398282201788,306.06601717798213 A 150,150 0 0,1 50.0,200.00000000000003 Z"/>
                        <path class="clickable-slice" data-slice="4" d="M 200,200 L 50.0,200.00000000000003 A 150,150 0 0,1 93.93398282201785,93.93398282201788 Z"/>
                        <path class="clickable-slice" data-slice="5" d="M 200,200 L 93.93398282201785,93.93398282201788 A 150,150 0 0,1 199.99999999999997,50.0 Z"/>
                        <path class="clickable-slice" data-slice="6" d="M 200,200 L 199.99999999999997,50.0 A 150,150 0 0,1 306.0660171779821,93.93398282201785 Z"/>
                        <path class="clickable-slice" data-slice="7" d="M 200,200 L 306.0660171779821,93.93398282201785 A 150,150 0 0,1 350.0,199.99999999999997 Z"/>
                        </g>
                        <circle cx="200" cy="200" r="30.0" fill="#FFFF99"/>
                        <text x="200" y="200" font-size="16" font-weight="bold" text-anchor="middle" alignment-baseline="middle">Core</text>
                        <text font-size="6.0" fill="green"><textPath href="#arc0" startOffset="50%" text-anchor="middle">Strategic power projection</textPath></text>
                        <text font-size="10.0" fill="black"><textPath href="#arc1" startOffset="50%" text-anchor="middle">initiates</textPath></text>
                        <text font-size="10.0" fill="black"><textPath href="#arc2" startOffset="50%" text-anchor="middle">Putin</textPath></text>
                        <text font-size="14" fill="red"><textPath href="#arc3" startOffset="50%" text-anchor="middle">aggression</textPath></text>
                        <text font-size="14" fill="red"><textPath href="#arc4" startOffset="50%" text-anchor="middle">Destructive</textPath></text>
                        <text font-size="6.0" fill="green"><textPath href="#arc5" startOffset="50%" text-anchor="middle">Liberation and sovereignty protected</textPath></text>
                        <text font-size="10.0" fill="black"><textPath href="#arc6" startOffset="50%" text-anchor="middle">resists</textPath></text>
                        <text font-size="10.0" fill="black"><textPath href="#arc7" startOffset="50%" text-anchor="middle">Ukraine</textPath></text>
                        <text font-size="14" fill="red"><textPath href="#arc8" startOffset="50%" text-anchor="middle">conflict and</textPath></text>
                        <text font-size="14" fill="red"><textPath href="#arc9" startOffset="50%" text-anchor="middle">Endless</textPath></text>
                        <text font-size="6.0" fill="green"><textPath href="#arc10" startOffset="50%" text-anchor="middle">Ukrainian victory approaches</textPath></text>
                        <text font-size="10.0" fill="black"><textPath href="#arc11" startOffset="50%" text-anchor="middle">offensive</textPath></text>
                        <text font-size="10.0" fill="black"><textPath href="#arc12" startOffset="50%" text-anchor="middle">Russian</textPath></text>
                        <text font-size="14" fill="red"><textPath href="#arc13" startOffset="50%" text-anchor="middle">resources</textPath></text>
                        <text font-size="14" fill="red"><textPath href="#arc14" startOffset="50%" text-anchor="middle">Military</textPath></text>
                        <text font-size="6.0" fill="green"><textPath href="#arc15" startOffset="50%" text-anchor="middle">Freedom restored</textPath></text>
                        <text font-size="10.0" fill="black"><textPath href="#arc16" startOffset="50%" text-anchor="middle">victory</textPath></text>
                        <text font-size="10.0" fill="black"><textPath href="#arc17" startOffset="50%" text-anchor="middle">Ukrainian</textPath></text>
                        <text font-size="14" fill="red"><textPath href="#arc18" startOffset="50%" text-anchor="middle">intensifies</textPath></text>
                        <text font-size="14" fill="red"><textPath href="#arc19" startOffset="50%" text-anchor="middle">Vengeance</textPath></text>
                        <text font-size="6.0" fill="green"><textPath href="#arc20" startOffset="50%" text-anchor="middle">Mutual understanding</textPath></text>
                        <text font-size="10.0" fill="black"><textPath href="#arc21" startOffset="50%" text-anchor="middle">negotiations</textPath></text>
                        <text font-size="10.0" fill="black"><textPath href="#arc22" startOffset="50%" text-anchor="middle">Peace</textPath></text>
                        <text font-size="14" fill="red"><textPath href="#arc23" startOffset="50%" text-anchor="middle">submission</textPath></text>
                        <text font-size="14" fill="red"><textPath href="#arc24" startOffset="50%" text-anchor="middle">Passive</textPath></text>
                        <text font-size="6.0" fill="green"><textPath href="#arc25" startOffset="50%" text-anchor="middle">Immediate peace achieved</textPath></text>
                        <text font-size="10.0" fill="black"><textPath href="#arc26" startOffset="50%" text-anchor="middle">surrenders</textPath></text>
                        <text font-size="10.0" fill="black"><textPath href="#arc27" startOffset="50%" text-anchor="middle">Ukraine</textPath></text>
                        <text font-size="14" fill="red"><textPath href="#arc28" startOffset="50%" text-anchor="middle">independence</textPath></text>
                        <text font-size="14" fill="red"><textPath href="#arc29" startOffset="50%" text-anchor="middle">Freedom and</textPath></text>
                        <text font-size="6.0" fill="green"><textPath href="#arc30" startOffset="50%" text-anchor="middle">Strategic military strength maintained</textPath></text>
                        <text font-size="10.0" fill="black"><textPath href="#arc31" startOffset="50%" text-anchor="middle">military</textPath></text>
                        <text font-size="10.0" fill="black"><textPath href="#arc32" startOffset="50%" text-anchor="middle">Russian</textPath></text>
                        <text font-size="14" fill="red"><textPath href="#arc33" startOffset="50%" text-anchor="middle">inevitable</textPath></text>
                        <text font-size="14" fill="red"><textPath href="#arc34" startOffset="50%" text-anchor="middle">Total defeat</textPath></text>
                        <text font-size="6.0" fill="green"><textPath href="#arc35" startOffset="50%" text-anchor="middle">Stability maintained</textPath></text>
                        <text font-size="10.0" fill="black"><textPath href="#arc36" startOffset="50%" text-anchor="middle">dominance</textPath></text>
                        <text font-size="10.0" fill="black"><textPath href="#arc37" startOffset="50%" text-anchor="middle">Russian</textPath></text>
                        <text font-size="14" fill="red"><textPath href="#arc38" startOffset="50%" text-anchor="middle">deepens</textPath></text>
                        <text font-size="14" fill="red"><textPath href="#arc39" startOffset="50%" text-anchor="middle">Oppression</textPath></text>
                        <g id="slice-boundaries">
                        <line class="slice-boundary" x1="200" y1="200" x2="350.0" y2="200.0" stroke="#888" stroke-width="1"/>
                        <line class="slice-boundary" x1="200" y1="200" x2="306.06601717798213" y2="306.06601717798213" stroke="#888" stroke-width="1"/>
                        <line class="slice-boundary" x1="200" y1="200" x2="200.0" y2="350.0" stroke="#888" stroke-width="1"/>
                        <line class="slice-boundary" x1="200" y1="200" x2="93.93398282201788" y2="306.06601717798213" stroke="#888" stroke-width="1"/>
                        <line class="slice-boundary" x1="200" y1="200" x2="50.0" y2="200.00000000000003" stroke="#888" stroke-width="1"/>
                        <line class="slice-boundary" x1="200" y1="200" x2="93.93398282201785" y2="93.93398282201788" stroke="#888" stroke-width="1"/>
                        <line class="slice-boundary" x1="200" y1="200" x2="199.99999999999997" y2="50.0" stroke="#888" stroke-width="1"/>
                        <line class="slice-boundary" x1="200" y1="200" x2="306.0660171779821" y2="93.93398282201785" stroke="#888" stroke-width="1"/>
                        </g>
                        </g>
                </g>
            </svg>
        </div>
    </div>
    <div class="bottom-bar">
        <button class="bottom-btn">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#0074d9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
            Enrich
        </button>
        <button class="bottom-btn" onclick="resetSlices()">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#0074d9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
            Reset
        </button>
    </div>
    
    <script>
        // Slice enlargement functionality
        class DialecticalWheel {
            constructor() {
                // Automatically detect slice count from SVG
                const clickableSlices = document.querySelectorAll('.clickable-slice');
                this.sliceCount = clickableSlices.length;
                this.centerX = 200;
                this.centerY = 200;
                this.radius = 150;
                
                // Initialize with equal angles based on detected slice count
                const equalAngle = 360 / this.sliceCount;
                this.sliceAngles = Array(this.sliceCount).fill(equalAngle);
                
                this.setupSliceInteraction();
            }
            
            setupSliceInteraction() {
                const clickableSlices = document.querySelectorAll('.clickable-slice');
                clickableSlices.forEach((slice, index) => {
                    // Desktop click
                    slice.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.enlargeSlice(index);
                    });
                    
                    // Mobile touch handling for more responsive taps
                    let touchStartTime = 0;
                    let touchStartPos = null;
                    
                    slice.addEventListener('touchstart', (e) => {
                        e.stopPropagation();
                        touchStartTime = Date.now();
                        const touch = e.touches[0];
                        touchStartPos = { x: touch.clientX, y: touch.clientY };
                    });
                    
                    slice.addEventListener('touchend', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const touchDuration = Date.now() - touchStartTime;
                        const touch = e.changedTouches[0];
                        const touchEndPos = { x: touch.clientX, y: touch.clientY };
                        
                        // Check if it was a quick tap (not a drag) and didn't move much
                        const distance = Math.sqrt(
                            Math.pow(touchEndPos.x - touchStartPos.x, 2) + 
                            Math.pow(touchEndPos.y - touchStartPos.y, 2)
                        );
                        
                        // Quick tap with minimal movement = enlarge slice
                        if (touchDuration < 300 && distance < 20) {
                            this.enlargeSlice(index);
                        }
                    });
                });
            }
            
            enlargeSlice(targetIndex) {
                const enlargeAmount = 45; // degrees to add
                const totalReduction = enlargeAmount;
                const reductionPerNeighbor = totalReduction / (this.sliceCount - 1);
                
                // Enlarge target slice
                this.sliceAngles[targetIndex] = Math.min(
                    this.sliceAngles[targetIndex] + enlargeAmount,
                    150 // Max size
                );
                
                // Reduce other slices proportionally
                for (let i = 0; i < this.sliceCount; i++) {
                    if (i !== targetIndex) {
                        this.sliceAngles[i] = Math.max(
                            this.sliceAngles[i] - reductionPerNeighbor,
                            15 // Minimum size
                        );
                    }
                }
                
                // Normalize to ensure total is 360 degrees
                this.normalizeAngles();
                
                // Update slice paths and boundaries
                this.updateAllSlices();
            }
            
            normalizeAngles() {
                const total = this.sliceAngles.reduce((sum, angle) => sum + angle, 0);
                const factor = 360 / total;
                this.sliceAngles = this.sliceAngles.map(angle => angle * factor);
            }
            
            updateAllSlices() {
                this.updateClickableSlices();
                this.updateSliceBoundaries();
                this.updateArcPaths();
            }
            
            updateClickableSlices() {
                const clickableSlices = document.querySelectorAll('.clickable-slice');
                let currentAngle = 0;
                
                clickableSlices.forEach((slice, index) => {
                    const startAngle = currentAngle;
                    const endAngle = currentAngle + this.sliceAngles[index];
                    
                    const pathData = this.createSlicePath(startAngle, endAngle);
                    slice.setAttribute('d', pathData);
                    
                    currentAngle += this.sliceAngles[index];
                });
            }
            
            updateSliceBoundaries() {
                const boundaries = document.querySelectorAll('.slice-boundary');
                let currentAngle = 0;
                
                boundaries.forEach((line, index) => {
                    const angleRad = (currentAngle * Math.PI) / 180;
                    const x2 = this.centerX + this.radius * Math.cos(angleRad);
                    const y2 = this.centerY + this.radius * Math.sin(angleRad);
                    
                    line.setAttribute('x2', x2);
                    line.setAttribute('y2', y2);
                    
                    currentAngle += this.sliceAngles[index];
                });
            }
            
            updateArcPaths() {
                // Update arc paths for text positioning
                const arcPaths = document.querySelectorAll('path[id^="arc"]');
                let currentAngle = 0;
                let arcIndex = 0;
                
                for (let sliceIndex = 0; sliceIndex < this.sliceCount; sliceIndex++) {
                    const sliceAngle = this.sliceAngles[sliceIndex];
                    const startAngle = currentAngle;
                    const endAngle = currentAngle + sliceAngle;
                    
                    // Update 5 arcs per slice (different radii)
                    for (let layerIndex = 0; layerIndex < 5; layerIndex++) {
                        if (arcIndex < arcPaths.length) {
                            const radius = 60 + layerIndex * 19.5; // Match original radii
                            const pathData = this.createArcPath(startAngle, endAngle, radius);
                            arcPaths[arcIndex].setAttribute('d', pathData);
                            arcIndex++;
                        }
                    }
                    
                    currentAngle += sliceAngle;
                }
            }
            
            createSlicePath(startAngle, endAngle) {
                const startRad = (startAngle * Math.PI) / 180;
                const endRad = (endAngle * Math.PI) / 180;
                
                const x1 = this.centerX + this.radius * Math.cos(startRad);
                const y1 = this.centerY + this.radius * Math.sin(startRad);
                const x2 = this.centerX + this.radius * Math.cos(endRad);
                const y2 = this.centerY + this.radius * Math.sin(endRad);
                
                const largeArcFlag = endAngle - startAngle > 180 ? 1 : 0;
                
                return `M ${this.centerX},${this.centerY} L ${x1},${y1} A ${this.radius},${this.radius} 0 ${largeArcFlag},1 ${x2},${y2} Z`;
            }
            
            createArcPath(startAngle, endAngle, radius) {
                const startRad = (startAngle * Math.PI) / 180;
                const endRad = (endAngle * Math.PI) / 180;
                
                const x1 = this.centerX + radius * Math.cos(startRad);
                const y1 = this.centerY + radius * Math.sin(startRad);
                const x2 = this.centerX + radius * Math.cos(endRad);
                const y2 = this.centerY + radius * Math.sin(endRad);
                
                const largeArcFlag = endAngle - startAngle > 180 ? 1 : 0;
                
                return `M ${x1},${y1} A ${radius},${radius} 0 ${largeArcFlag},1 ${x2},${y2}`;
            }
            
            reset() {
                this.sliceAngles = Array(this.sliceCount).fill(360 / this.sliceCount);
                this.updateAllSlices();
            }
        }
        
        // Initialize wheel
        const dialecticalWheel = new DialecticalWheel();
        
        // Global reset function
        function resetSlices() {
            dialecticalWheel.reset();
        }

        // Existing rotation and zoom functionality
        const record = document.querySelector('.record');
        let rotation = 0;
        let isDragging = false;
        let startAngle = 0;
        let startRotation = 0;
        let scale = 1;
        let startScale = 1;
        let isPinching = false;
        let pinchStartDist = 0;
        let offsetX = 0;
        let offsetY = 0;
        let startOffsetX = 0;
        let startOffsetY = 0;
        let pinchMidStart = {x: 200, y: 200};

        function getCenter(el) {
            const rect = el.getBoundingClientRect();
            return {
                x: rect.left + rect.width / 2,
                y: rect.top + rect.height / 2
            };
        }

        function clientToSvg(svg, clientX, clientY) {
            const pt = svg.createSVGPoint();
            pt.x = clientX;
            pt.y = clientY;
            return pt.matrixTransform(svg.getScreenCTM().inverse());
        }

        function setTransform() {
            record.setAttribute('transform', `translate(${offsetX} ${offsetY}) translate(200 200) scale(${scale}) rotate(${rotation}) translate(-200 -200)`);
        }

        record.addEventListener('mousedown', (e) => {
            if (e.touches && e.touches.length > 1) return;
            // Check if click is on a slice - if so, don't start rotation
            if (e.target.classList.contains('clickable-slice')) return;
            
            isDragging = true;
            const center = getCenter(record.closest('svg'));
            startAngle = Math.atan2(e.clientY - center.y, e.clientX - center.x);
            startRotation = rotation;
            document.body.style.userSelect = 'none';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging || isPinching) return;
            const center = getCenter(record.closest('svg'));
            const currentAngle = Math.atan2(e.clientY - center.y, e.clientX - center.x);
            let angleDiff = currentAngle - startAngle;
            if (angleDiff > Math.PI) angleDiff -= 2 * Math.PI;
            if (angleDiff < -Math.PI) angleDiff += 2 * Math.PI;
            rotation = startRotation + (angleDiff * (180 / Math.PI));
            setTransform();
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            document.body.style.userSelect = '';
        });

        // Touch support for mobile
        record.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (e.touches.length === 2) {
                isPinching = true;
                isDragging = false;
                pinchStartDist = Math.hypot(
                    e.touches[0].clientX - e.touches[1].clientX,
                    e.touches[0].clientY - e.touches[1].clientY
                );
                startScale = scale;
                const svg = record.closest('svg');
                const midClientX = (e.touches[0].clientX + e.touches[1].clientX) / 2;
                const midClientY = (e.touches[0].clientY + e.touches[1].clientY) / 2;
                pinchMidStart = clientToSvg(svg, midClientX, midClientY);
                startOffsetX = offsetX;
                startOffsetY = offsetY;
            } else if (e.touches.length === 1) {
                const touch = e.touches[0];
                // Check if touch is on a slice
                const target = document.elementFromPoint(touch.clientX, touch.clientY);
                if (target && target.classList.contains('clickable-slice')) return;
                
                isDragging = true;
                isPinching = false;
                const center = getCenter(record.closest('svg'));
                startAngle = Math.atan2(touch.clientY - center.y, touch.clientX - center.x);
                startRotation = rotation;
            }
            document.body.style.userSelect = 'none';
        });

        record.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (isPinching && e.touches.length === 2) {
                const dist = Math.hypot(
                    e.touches[0].clientX - e.touches[1].clientX,
                    e.touches[0].clientY - e.touches[1].clientY
                );
                let newScale = startScale * (dist / pinchStartDist);
                newScale = Math.max(1, Math.min(newScale, 3));
                const center = {x: 200, y: 200};
                offsetX = startOffsetX + (pinchMidStart.x - center.x) * (1 - newScale / startScale);
                offsetY = startOffsetY + (pinchMidStart.y - center.y) * (1 - newScale / startScale);
                if (newScale === 1) {
                    offsetX = 0;
                    offsetY = 0;
                }
                scale = newScale;
                setTransform();
            } else if (isDragging && e.touches.length === 1) {
                const touch = e.touches[0];
                const center = getCenter(record.closest('svg'));
                const currentAngle = Math.atan2(touch.clientY - center.y, touch.clientX - center.x);
                let angleDiff = currentAngle - startAngle;
                if (angleDiff > Math.PI) angleDiff -= 2 * Math.PI;
                if (angleDiff < -Math.PI) angleDiff += 2 * Math.PI;
                rotation = startRotation + (angleDiff * (180 / Math.PI));
                setTransform();
            }
        }, { passive: false });

        document.addEventListener('touchend', (e) => {
            if (e.touches.length === 0) {
                isDragging = false;
                isPinching = false;
                document.body.style.userSelect = '';
            }
        });

        // Initial transform
        setTransform();
    </script>
</body>
</html>
