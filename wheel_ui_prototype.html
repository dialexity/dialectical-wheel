<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Win-Win Wheel</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #f7f7f7;
            font-family: 'Arial Rounded MT Bold', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #fff;
            border-bottom: 1px solid #ddd;
            padding: 0.5em 1em;
            height: 48px;
        }
        .header .icon {
            font-size: 1.5em;
            color: #222;
            background: none;
            border: none;
            padding: 0 0.3em;
            cursor: pointer;
        }
        .header-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #222;
        }
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.5em 0.5em 2em 0.5em;
        }
        .wheel-container {
            width: 100vw;
            max-width: 100vw;
            max-height: 100%;
        }
        .wheel-svg {
            width: 100vw;
            height: 100vw;
            max-width: 100vw;
            max-height: 100%;
            display: block;
        }
        .bottom-bar {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            background: #fff;
            border-top: 1px solid #ddd;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0.5em 0;
            z-index: 10;
        }
        .bottom-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 1.1em;
            color: #0074d9;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5em 1em;
        }
        .bottom-btn svg {
            margin-bottom: 0.2em;
        }
        @media (max-width: 500px) {
            .wheel-container {
                width: 100vw;
                max-width: 100vw;
            }
            .wheel-svg {
                width: 100vw;
                height: 100vw;
                max-width: 100vw;
                max-height: 100vw;
            }
        }
        .record {
            width: 100%;
            height: 100%;
            cursor: grab;
            touch-action: none;
        }
        
        /* Styles for clickable slices with thesis/antithesis distinction */
        .clickable-slice {
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            cursor: pointer;
            fill: transparent;
            stroke: transparent;
            stroke-width: 2;
        }
        .clickable-slice:hover {
            stroke: rgba(0, 116, 217, 0.3);
            fill: rgba(0, 116, 217, 0.1);
        }
        
        /* Different hover colors for thesis vs antithesis */
        .thesis-slice .clickable-slice:hover {
            stroke: rgba(76, 175, 80, 0.3);
            fill: rgba(76, 175, 80, 0.1);
        }
        .antithesis-slice .clickable-slice:hover {
            stroke: rgba(244, 67, 54, 0.3);
            fill: rgba(244, 67, 54, 0.1);
        }
        
        .slice-boundary {
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .slice-component {
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            transform-origin: 200px 200px;
        }
        
        /* Highlighting for paired slices */
        .slice-component.paired-highlight {
            filter: brightness(1.1) drop-shadow(0 0 8px rgba(0, 116, 217, 0.5));
        }
        
        /* Special styling for focused thesis-antithesis pair */
        .slice-component.focused-pair {
            filter: brightness(1.2) drop-shadow(0 0 12px rgba(0, 116, 217, 0.8));
        }
        
        .focused-pair .clickable-slice {
            stroke: rgba(0, 116, 217, 0.6) !important;
            stroke-width: 3 !important;
        }
        
        /* Enhanced visual connection for focused pairs */
        .focused-pair.thesis-slice {
            filter: brightness(1.2) drop-shadow(0 0 12px rgba(76, 175, 80, 0.8));
        }
        
        .focused-pair.antithesis-slice {
            filter: brightness(1.2) drop-shadow(0 0 12px rgba(244, 67, 54, 0.8));
        }
        
        .controls-overlay {
            position: absolute;
            top: 60px;
            left: 20px;
            color: #333;
            font-size: 12px;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px;
            border-radius: 4px;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <button class="icon" aria-label="Menu">&#9776;</button>
        <span class="header-title">Win-Win</span>
        <div>
            <button class="icon" aria-label="Help">&#x2753;</button>
            <button class="icon" aria-label="Zoom">&#128269;</button>
            <button class="icon" aria-label="Close">&#10006;</button>
        </div>
    </div>
    <div class="main-content">
        <div class="controls-overlay">
            Drag to rotate • Pinch to zoom • Click thesis/antithesis pairs to see opposition clearly
        </div>
        <div class="wheel-container">
            <!-- Generate the thesis-antithesis wheel using the new SVG generator -->
            <svg class="wheel-svg" viewBox="0 0 400 400">
                <g class="record">
                    <defs>
                    </defs>
                    <g id="slice-container">
                        <!-- Thesis-Antithesis Pair 0: Strategic Power vs Peace Negotiations -->
                        <!-- Thesis at 0° -->
                        <g class="slice-component thesis-slice" data-slice="0" data-pair="0" data-type="thesis" transform="rotate(0 200 200)">
                            <path d="M 240.0,130.71796769724492 A 80.0,80.0 0 0,1 240.0,269.28203230275506 L 222.5,238.97114317029974 A 45.0,45.0 0 0,0 222.5,161.02885682970026 Z" fill="#C6E5B3" stroke="#888" stroke-width="0.5"/>
                            <path d="M 257.5,100.40707856478957 A 114.99999999999999,114.99999999999999 0 0,1 257.5,299.5929214352104 L 240.0,269.28203230275506 A 80.0,80.0 0 0,0 240.0,130.71796769724492 Z" fill="#FFFFFF" stroke="#888" stroke-width="0.5"/>
                            <path d="M 275.0,70.09618943233423 A 149.99999999999997,149.99999999999997 0 0,1 275.0,329.9038105676658 L 257.5,299.5929214352104 A 114.99999999999999,114.99999999999999 0 0,0 257.5,100.40707856478957 Z" fill="#F9C6CC" stroke="#888" stroke-width="0.5"/>
                            <path id="slice-0-arc-0" d="M 235.0,139.3782217350893 A 70.0,70.0 0 0,1 235.0,260.6217782649107" fill="none"/>
                            <text font-size="8" fill="green"><textPath href="#slice-0-arc-0" startOffset="50%" text-anchor="middle">Strategic power projection</textPath></text>
                            <path id="slice-0-arc-1" d="M 252.5,109.06733260263395 A 104.99999999999999,104.99999999999999 0 0,1 252.5,290.93266739736606" fill="none"/>
                            <text font-size="10" fill="black"><textPath href="#slice-0-arc-1" startOffset="50%" text-anchor="middle">Putin initiates war</textPath></text>
                            <path id="slice-0-arc-2" d="M 270.0,78.75644347017862 A 139.99999999999997,139.99999999999997 0 0,1 270.0,321.2435565298214" fill="none"/>
                            <text font-size="14" fill="red"><textPath href="#slice-0-arc-2" startOffset="50%" text-anchor="middle">Destructive aggression</textPath></text>
                            <line x1="200" y1="200" x2="275.0" y2="70.0961894323342" stroke="#888" stroke-width="1"/>
                            <line x1="200" y1="200" x2="275.0" y2="329.9038105676658" stroke="#888" stroke-width="1"/>
                            <path class="clickable-slice" data-slice="0" data-pair="0" data-type="thesis" d="M 200,200 L 275.0,70.0961894323342 A 150,150 0 0,1 275.0,329.9038105676658 Z" fill="transparent" stroke="transparent"/>
                        </g>
                        
                        <!-- Thesis-Antithesis Pair 1: Resistance vs Surrender -->
                        <!-- Thesis at 120° -->
                        <g class="slice-component thesis-slice" data-slice="1" data-pair="1" data-type="thesis" transform="rotate(120 200 200)">
                            <path d="M 240.0,130.71796769724492 A 80.0,80.0 0 0,1 240.0,269.28203230275506 L 222.5,238.97114317029974 A 45.0,45.0 0 0,0 222.5,161.02885682970026 Z" fill="#C6E5B3" stroke="#888" stroke-width="0.5"/>
                            <path d="M 257.5,100.40707856478957 A 114.99999999999999,114.99999999999999 0 0,1 257.5,299.5929214352104 L 240.0,269.28203230275506 A 80.0,80.0 0 0,0 240.0,130.71796769724492 Z" fill="#FFFFFF" stroke="#888" stroke-width="0.5"/>
                            <path d="M 275.0,70.09618943233423 A 149.99999999999997,149.99999999999997 0 0,1 275.0,329.9038105676658 L 257.5,299.5929214352104 A 114.99999999999999,114.99999999999999 0 0,0 257.5,100.40707856478957 Z" fill="#F9C6CC" stroke="#888" stroke-width="0.5"/>
                            <path id="slice-1-arc-0" d="M 235.0,139.3782217350893 A 70.0,70.0 0 0,1 235.0,260.6217782649107" fill="none"/>
                            <text font-size="8" fill="green"><textPath href="#slice-1-arc-0" startOffset="50%" text-anchor="middle">Liberation and sovereignty</textPath></text>
                            <path id="slice-1-arc-1" d="M 252.5,109.06733260263395 A 104.99999999999999,104.99999999999999 0 0,1 252.5,290.93266739736606" fill="none"/>
                            <text font-size="10" fill="black"><textPath href="#slice-1-arc-1" startOffset="50%" text-anchor="middle">Ukraine resists invasion</textPath></text>
                            <path id="slice-1-arc-2" d="M 270.0,78.75644347017862 A 139.99999999999997,139.99999999999997 0 0,1 270.0,321.2435565298214" fill="none"/>
                            <text font-size="14" fill="red"><textPath href="#slice-1-arc-2" startOffset="50%" text-anchor="middle">Endless conflict</textPath></text>
                            <line x1="200" y1="200" x2="275.0" y2="70.0961894323342" stroke="#888" stroke-width="1"/>
                            <line x1="200" y1="200" x2="275.0" y2="329.9038105676658" stroke="#888" stroke-width="1"/>
                            <path class="clickable-slice" data-slice="1" data-pair="1" data-type="thesis" d="M 200,200 L 275.0,70.0961894323342 A 150,150 0 0,1 275.0,329.9038105676658 Z" fill="transparent" stroke="transparent"/>
                        </g>
                        
                        <!-- Thesis-Antithesis Pair 2: Victory vs Dominance -->
                        <!-- Thesis at 240° -->
                        <g class="slice-component thesis-slice" data-slice="2" data-pair="2" data-type="thesis" transform="rotate(240 200 200)">
                            <path d="M 240.0,130.71796769724492 A 80.0,80.0 0 0,1 240.0,269.28203230275506 L 222.5,238.97114317029974 A 45.0,45.0 0 0,0 222.5,161.02885682970026 Z" fill="#C6E5B3" stroke="#888" stroke-width="0.5"/>
                            <path d="M 257.5,100.40707856478957 A 114.99999999999999,114.99999999999999 0 0,1 257.5,299.5929214352104 L 240.0,269.28203230275506 A 80.0,80.0 0 0,0 240.0,130.71796769724492 Z" fill="#FFFFFF" stroke="#888" stroke-width="0.5"/>
                            <path d="M 275.0,70.09618943233423 A 149.99999999999997,149.99999999999997 0 0,1 275.0,329.9038105676658 L 257.5,299.5929214352104 A 114.99999999999999,114.99999999999999 0 0,0 257.5,100.40707856478957 Z" fill="#F9C6CC" stroke="#888" stroke-width="0.5"/>
                            <path id="slice-2-arc-0" d="M 235.0,139.3782217350893 A 70.0,70.0 0 0,1 235.0,260.6217782649107" fill="none"/>
                            <text font-size="8" fill="green"><textPath href="#slice-2-arc-0" startOffset="50%" text-anchor="middle">Victory approaches</textPath></text>
                            <path id="slice-2-arc-1" d="M 252.5,109.06733260263395 A 104.99999999999999,104.99999999999999 0 0,1 252.5,290.93266739736606" fill="none"/>
                            <text font-size="10" fill="black"><textPath href="#slice-2-arc-1" startOffset="50%" text-anchor="middle">Russian offensive weakens</textPath></text>
                            <path id="slice-2-arc-2" d="M 270.0,78.75644347017862 A 139.99999999999997,139.99999999999997 0 0,1 270.0,321.2435565298214" fill="none"/>
                            <text font-size="14" fill="red"><textPath href="#slice-2-arc-2" startOffset="50%" text-anchor="middle">Resources drain rapidly</textPath></text>
                            <line x1="200" y1="200" x2="275.0" y2="70.0961894323342" stroke="#888" stroke-width="1"/>
                            <line x1="200" y1="200" x2="275.0" y2="329.9038105676658" stroke="#888" stroke-width="1"/>
                            <path class="clickable-slice" data-slice="2" data-pair="2" data-type="thesis" d="M 200,200 L 275.0,70.0961894323342 A 150,150 0 0,1 275.0,329.9038105676658 Z" fill="transparent" stroke="transparent"/>
                        </g>
                        
                        <!-- Antithesis at 180° (opposite of thesis 0) -->
                        <g class="slice-component antithesis-slice" data-slice="3" data-pair="0" data-type="antithesis" transform="rotate(180 200 200)">
                            <path d="M 240.0,130.71796769724492 A 80.0,80.0 0 0,1 240.0,269.28203230275506 L 222.5,238.97114317029974 A 45.0,45.0 0 0,0 222.5,161.02885682970026 Z" fill="#C6E5B3" stroke="#888" stroke-width="0.5"/>
                            <path d="M 257.5,100.40707856478957 A 114.99999999999999,114.99999999999999 0 0,1 257.5,299.5929214352104 L 240.0,269.28203230275506 A 80.0,80.0 0 0,0 240.0,130.71796769724492 Z" fill="#FFFFFF" stroke="#888" stroke-width="0.5"/>
                            <path d="M 275.0,70.09618943233423 A 149.99999999999997,149.99999999999997 0 0,1 275.0,329.9038105676658 L 257.5,299.5929214352104 A 114.99999999999999,114.99999999999999 0 0,0 257.5,100.40707856478957 Z" fill="#F9C6CC" stroke="#888" stroke-width="0.5"/>
                            <path id="slice-3-arc-0" d="M 235.0,139.3782217350893 A 70.0,70.0 0 0,1 235.0,260.6217782649107" fill="none"/>
                            <text font-size="8" fill="green"><textPath href="#slice-3-arc-0" startOffset="50%" text-anchor="middle">Mutual understanding</textPath></text>
                            <path id="slice-3-arc-1" d="M 252.5,109.06733260263395 A 104.99999999999999,104.99999999999999 0 0,1 252.5,290.93266739736606" fill="none"/>
                            <text font-size="10" fill="black"><textPath href="#slice-3-arc-1" startOffset="50%" text-anchor="middle">Peace negotiations</textPath></text>
                            <path id="slice-3-arc-2" d="M 270.0,78.75644347017862 A 139.99999999999997,139.99999999999997 0 0,1 270.0,321.2435565298214" fill="none"/>
                            <text font-size="14" fill="red"><textPath href="#slice-3-arc-2" startOffset="50%" text-anchor="middle">Passive submission</textPath></text>
                            <line x1="200" y1="200" x2="275.0" y2="70.0961894323342" stroke="#888" stroke-width="1"/>
                            <line x1="200" y1="200" x2="275.0" y2="329.9038105676658" stroke="#888" stroke-width="1"/>
                            <path class="clickable-slice" data-slice="3" data-pair="0" data-type="antithesis" d="M 200,200 L 275.0,70.0961894323342 A 150,150 0 0,1 275.0,329.9038105676658 Z" fill="transparent" stroke="transparent"/>
                        </g>
                        
                        <!-- Antithesis at 300° (opposite of thesis 1) -->
                        <g class="slice-component antithesis-slice" data-slice="4" data-pair="1" data-type="antithesis" transform="rotate(300 200 200)">
                            <path d="M 240.0,130.71796769724492 A 80.0,80.0 0 0,1 240.0,269.28203230275506 L 222.5,238.97114317029974 A 45.0,45.0 0 0,0 222.5,161.02885682970026 Z" fill="#C6E5B3" stroke="#888" stroke-width="0.5"/>
                            <path d="M 257.5,100.40707856478957 A 114.99999999999999,114.99999999999999 0 0,1 257.5,299.5929214352104 L 240.0,269.28203230275506 A 80.0,80.0 0 0,0 240.0,130.71796769724492 Z" fill="#FFFFFF" stroke="#888" stroke-width="0.5"/>
                            <path d="M 275.0,70.09618943233423 A 149.99999999999997,149.99999999999997 0 0,1 275.0,329.9038105676658 L 257.5,299.5929214352104 A 114.99999999999999,114.99999999999999 0 0,0 257.5,100.40707856478957 Z" fill="#F9C6CC" stroke="#888" stroke-width="0.5"/>
                            <path id="slice-4-arc-0" d="M 235.0,139.3782217350893 A 70.0,70.0 0 0,1 235.0,260.6217782649107" fill="none"/>
                            <text font-size="8" fill="green"><textPath href="#slice-4-arc-0" startOffset="50%" text-anchor="middle">Immediate peace achieved</textPath></text>
                            <path id="slice-4-arc-1" d="M 252.5,109.06733260263395 A 104.99999999999999,104.99999999999999 0 0,1 252.5,290.93266739736606" fill="none"/>
                            <text font-size="10" fill="black"><textPath href="#slice-4-arc-1" startOffset="50%" text-anchor="middle">Ukraine surrenders</textPath></text>
                            <path id="slice-4-arc-2" d="M 270.0,78.75644347017862 A 139.99999999999997,139.99999999999997 0 0,1 270.0,321.2435565298214" fill="none"/>
                            <text font-size="14" fill="red"><textPath href="#slice-4-arc-2" startOffset="50%" text-anchor="middle">Freedom lost</textPath></text>
                            <line x1="200" y1="200" x2="275.0" y2="70.0961894323342" stroke="#888" stroke-width="1"/>
                            <line x1="200" y1="200" x2="275.0" y2="329.9038105676658" stroke="#888" stroke-width="1"/>
                            <path class="clickable-slice" data-slice="4" data-pair="1" data-type="antithesis" d="M 200,200 L 275.0,70.0961894323342 A 150,150 0 0,1 275.0,329.9038105676658 Z" fill="transparent" stroke="transparent"/>
                        </g>
                        
                        <!-- Antithesis at 60° (opposite of thesis 2) -->
                        <g class="slice-component antithesis-slice" data-slice="5" data-pair="2" data-type="antithesis" transform="rotate(60 200 200)">
                            <path d="M 240.0,130.71796769724492 A 80.0,80.0 0 0,1 240.0,269.28203230275506 L 222.5,238.97114317029974 A 45.0,45.0 0 0,0 222.5,161.02885682970026 Z" fill="#C6E5B3" stroke="#888" stroke-width="0.5"/>
                            <path d="M 257.5,100.40707856478957 A 114.99999999999999,114.99999999999999 0 0,1 257.5,299.5929214352104 L 240.0,269.28203230275506 A 80.0,80.0 0 0,0 240.0,130.71796769724492 Z" fill="#FFFFFF" stroke="#888" stroke-width="0.5"/>
                            <path d="M 275.0,70.09618943233423 A 149.99999999999997,149.99999999999997 0 0,1 275.0,329.9038105676658 L 257.5,299.5929214352104 A 114.99999999999999,114.99999999999999 0 0,0 257.5,100.40707856478957 Z" fill="#F9C6CC" stroke="#888" stroke-width="0.5"/>
                            <path id="slice-5-arc-0" d="M 235.0,139.3782217350893 A 70.0,70.0 0 0,1 235.0,260.6217782649107" fill="none"/>
                            <text font-size="8" fill="green"><textPath href="#slice-5-arc-0" startOffset="50%" text-anchor="middle">Military strength maintained</textPath></text>
                            <path id="slice-5-arc-1" d="M 252.5,109.06733260263395 A 104.99999999999999,104.99999999999999 0 0,1 252.5,290.93266739736606" fill="none"/>
                            <text font-size="10" fill="black"><textPath href="#slice-5-arc-1" startOffset="50%" text-anchor="middle">Russian dominance persists</textPath></text>
                            <path id="slice-5-arc-2" d="M 270.0,78.75644347017862 A 139.99999999999997,139.99999999999997 0 0,1 270.0,321.2435565298214" fill="none"/>
                            <text font-size="14" fill="red"><textPath href="#slice-5-arc-2" startOffset="50%" text-anchor="middle">Total defeat inevitable</textPath></text>
                            <line x1="200" y1="200" x2="275.0" y2="70.0961894323342" stroke="#888" stroke-width="1"/>
                            <line x1="200" y1="200" x2="275.0" y2="329.9038105676658" stroke="#888" stroke-width="1"/>
                            <path class="clickable-slice" data-slice="5" data-pair="2" data-type="antithesis" d="M 200,200 L 275.0,70.0961894323342 A 150,150 0 0,1 275.0,329.9038105676658 Z" fill="transparent" stroke="transparent"/>
                        </g>
                    </g>
                    <circle cx="200" cy="200" r="30.0" fill="#FFFF99"/>
                    <text x="200" y="200" font-size="16" font-weight="bold" text-anchor="middle" alignment-baseline="middle">Ukraine Conflict</text>
                </g>
            </svg>
        </div>
    </div>
    <div class="bottom-bar">
        <button class="bottom-btn">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#0074d9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
            Enrich
        </button>
        <button class="bottom-btn" onclick="resetSlices()">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#0074d9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
            Reset
        </button>
    </div>
    
    <script>
        // Thesis-Antithesis paired wheel management
        class DialecticalWheel {
            constructor() {
                this.centerX = 200;
                this.centerY = 200;
                this.sliceCount = 6; // 3 thesis-antithesis pairs
                this.pairCount = 3;
                this.enlargedPair = null;
                this.currentState = 'normal'; // 'normal', 'pair-focused', 'all-thesis', 'all-antithesis'
                
                // Map slice indices to their pairs and positions
                this.sliceMapping = {
                    0: { pair: 0, type: 'thesis', partner: 3, baseAngle: 0 },
                    1: { pair: 1, type: 'thesis', partner: 4, baseAngle: 120 },
                    2: { pair: 2, type: 'thesis', partner: 5, baseAngle: 240 },
                    3: { pair: 0, type: 'antithesis', partner: 0, baseAngle: 180 },
                    4: { pair: 1, type: 'antithesis', partner: 1, baseAngle: 300 },
                    5: { pair: 2, type: 'antithesis', partner: 2, baseAngle: 60 }
                };
                
                this.setupSliceInteraction();
                this.reset(); // Initialize proper positioning
            }
            
            setupSliceInteraction() {
                const slices = document.querySelectorAll('.clickable-slice');
                slices.forEach((slice, index) => {
                    slice.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.handleSliceClick(index);
                    });
                    
                    // Hover effects for pairs
                    slice.addEventListener('mouseenter', (e) => {
                        if (this.currentState === 'normal') {
                            this.highlightPair(this.sliceMapping[index].pair);
                        }
                    });
                    
                    slice.addEventListener('mouseleave', (e) => {
                        if (this.currentState === 'normal') {
                            this.clearHighlights();
                        }
                    });
                    
                    // Mobile touch handling
                    let touchStartTime = 0;
                    let touchStartPos = null;
                    
                    slice.addEventListener('touchstart', (e) => {
                        e.stopPropagation();
                        touchStartTime = Date.now();
                        const touch = e.touches[0];
                        touchStartPos = { x: touch.clientX, y: touch.clientY };
                    });
                    
                    slice.addEventListener('touchend', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const touchDuration = Date.now() - touchStartTime;
                        const touch = e.changedTouches[0];
                        const touchEndPos = { x: touch.clientX, y: touch.clientY };
                        
                        const distance = Math.sqrt(
                            Math.pow(touchEndPos.x - touchStartPos.x, 2) + 
                            Math.pow(touchEndPos.y - touchStartPos.y, 2)
                        );
                        
                        if (touchDuration < 300 && distance < 20) {
                            this.handleSliceClick(index);
                        }
                    });
                });
            }
            
            handleSliceClick(sliceIndex) {
                const mapping = this.sliceMapping[sliceIndex];
                
                if (this.currentState === 'normal') {
                    // From normal state: focus on the pair
                    this.enlargedPair = mapping.pair;
                    this.currentState = 'pair-focused';
                    this.createPairFocus(mapping.pair);
                } else if (this.currentState === 'pair-focused') {
                    // From pair-focused state: show all of the same type
                    if (mapping.type === 'thesis') {
                        this.currentState = 'all-thesis';
                        this.showAllThesis();
                    } else {
                        this.currentState = 'all-antithesis';
                        this.showAllAntithesis();
                    }
                } else if (this.currentState === 'all-thesis') {
                    // From all-thesis state: 
                    if (mapping.type === 'thesis') {
                        // Clicking a thesis slice - focus on its pair
                        this.enlargedPair = mapping.pair;
                        this.currentState = 'pair-focused';
                        this.createPairFocus(mapping.pair);
                    } else {
                        // Clicking an antithesis slice - show all antithesis
                        this.currentState = 'all-antithesis';
                        this.showAllAntithesis();
                    }
                } else if (this.currentState === 'all-antithesis') {
                    // From all-antithesis state:
                    if (mapping.type === 'antithesis') {
                        // Clicking an antithesis slice - focus on its pair
                        this.enlargedPair = mapping.pair;
                        this.currentState = 'pair-focused';
                        this.createPairFocus(mapping.pair);
                    } else {
                        // Clicking a thesis slice - show all thesis
                        this.currentState = 'all-thesis';
                        this.showAllThesis();
                    }
                }
            }
            
            showAllThesis() {
                const sliceComponents = document.querySelectorAll('.slice-component');
                
                // Remove any existing animations and reset transition
                this.clearAnimations();
                
                // Find all thesis and antithesis slices
                let thesisSlices = [];
                let antithesisSlices = [];
                
                sliceComponents.forEach((slice, index) => {
                    const mapping = this.sliceMapping[index];
                    if (mapping.type === 'thesis') {
                        thesisSlices.push({ element: slice, index, mapping });
                    } else {
                        antithesisSlices.push({ element: slice, index, mapping });
                    }
                });
                
                // Position thesis slices prominently with slight delay for smoothness
                thesisSlices.forEach(({ element, mapping }, i) => {
                    const angle = i * 120; // Distribute thesis slices at 0°, 120°, 240°
                    element.style.transformOrigin = '200px 200px';
                    element.style.transform = `rotate(${angle}deg) scale(1)`;
                    element.style.opacity = '1';
                    element.style.zIndex = '10';
                    element.classList.add('focused-pair');
                });
                
                // Smoothly transition antithesis slices out
                antithesisSlices.forEach(({ element }, i) => {
                    element.style.transformOrigin = '200px 200px';
                    element.style.transform = `rotate(${30 + i * 60}deg) scale(0.15)`;
                    element.style.opacity = '0.05';
                    element.style.zIndex = '1';
                    element.classList.remove('focused-pair');
                });
                
                this.removePairConnectionLine();
                this.updateControlsText('all-thesis');
                this.setTransitions();
            }
            
            showAllAntithesis() {
                const sliceComponents = document.querySelectorAll('.slice-component');
                
                // Remove any existing animations and reset transition
                this.clearAnimations();
                
                // Find all thesis and antithesis slices
                let thesisSlices = [];
                let antithesisSlices = [];
                
                sliceComponents.forEach((slice, index) => {
                    const mapping = this.sliceMapping[index];
                    if (mapping.type === 'thesis') {
                        thesisSlices.push({ element: slice, index, mapping });
                    } else {
                        antithesisSlices.push({ element: slice, index, mapping });
                    }
                });
                
                // Position antithesis slices prominently  
                antithesisSlices.forEach(({ element, mapping }, i) => {
                    const angle = i * 120; // Distribute antithesis slices at 0°, 120°, 240°
                    element.style.transformOrigin = '200px 200px';
                    element.style.transform = `rotate(${angle}deg) scale(1)`;
                    element.style.opacity = '1';
                    element.style.zIndex = '10';
                    element.classList.add('focused-pair');
                });
                
                // Smoothly transition thesis slices out
                thesisSlices.forEach(({ element }, i) => {
                    element.style.transformOrigin = '200px 200px';
                    element.style.transform = `rotate(${30 + i * 60}deg) scale(0.15)`;
                    element.style.opacity = '0.05';
                    element.style.zIndex = '1';
                    element.classList.remove('focused-pair');
                });
                
                this.removePairConnectionLine();
                this.updateControlsText('all-antithesis');
                this.setTransitions();
            }
            
            updateControlsText(state) {
                const controlsOverlay = document.querySelector('.controls-overlay');
                switch(state) {
                    case 'pair-focused':
                        controlsOverlay.textContent = 'Viewing thesis-antithesis pair • Click THESIS (top) for all thesis • Click ANTITHESIS (bottom) for all antithesis';
                        break;
                    case 'all-thesis':
                        controlsOverlay.textContent = 'Viewing all THESIS slices • Click any thesis to focus on its pair • Click tiny antithesis to see all antithesis';
                        break;
                    case 'all-antithesis':
                        controlsOverlay.textContent = 'Viewing all ANTITHESIS slices • Click any antithesis to focus on its pair • Click tiny thesis to see all thesis';
                        break;
                    default:
                        controlsOverlay.textContent = 'Drag to rotate • Pinch to zoom • Click any slice to focus on thesis-antithesis pair';
                }
            }
            
            highlightPair(pairIndex) {
                if (this.enlargedPair !== null) return; // Don't highlight during spiral mode
                
                const sliceComponents = document.querySelectorAll('.slice-component');
                sliceComponents.forEach((slice, index) => {
                    if (this.sliceMapping[index].pair === pairIndex) {
                        slice.classList.add('paired-highlight');
                    }
                });
            }
            
            clearHighlights() {
                const sliceComponents = document.querySelectorAll('.slice-component');
                sliceComponents.forEach(slice => {
                    slice.classList.remove('paired-highlight');
                });
            }
            
            createPairFocus(pairIndex) {
                const sliceComponents = document.querySelectorAll('.slice-component');
                
                // Remove any existing animations first
                this.clearAnimations();
                
                // Find thesis and antithesis slices for this pair
                let thesisSlice = null;
                let antithesisSlice = null;
                let otherSlices = [];
                
                sliceComponents.forEach((slice, index) => {
                    const mapping = this.sliceMapping[index];
                    if (mapping.pair === pairIndex) {
                        if (mapping.type === 'thesis') {
                            thesisSlice = { element: slice, index, mapping };
                        } else {
                            antithesisSlice = { element: slice, index, mapping };
                        }
                    } else {
                        otherSlices.push({ element: slice, index, mapping });
                    }
                });
                
                // Position thesis and antithesis directly opposite each other
                // Thesis at 0°, Antithesis at 180°
                const thesisAngle = 0;
                const antithesisAngle = 180;
                
                // Position thesis slice at 0°
                if (thesisSlice) {
                    thesisSlice.element.style.transformOrigin = '200px 200px';
                    thesisSlice.element.style.transform = `rotate(${thesisAngle}deg) scale(1)`;
                    thesisSlice.element.style.opacity = '1';
                    thesisSlice.element.style.zIndex = '10';
                    thesisSlice.element.classList.add('focused-pair');
                }
                
                // Position antithesis slice at 180° (directly opposite)
                if (antithesisSlice) {
                    antithesisSlice.element.style.transformOrigin = '200px 200px';
                    antithesisSlice.element.style.transform = `rotate(${antithesisAngle}deg) scale(1)`;
                    antithesisSlice.element.style.opacity = '1';
                    antithesisSlice.element.style.zIndex = '10';
                    antithesisSlice.element.classList.add('focused-pair');
                }
                
                // Position other slices around the remaining space, but make them smaller
                otherSlices.forEach(({ element }, i) => {
                    const angle = 90 + (i * 45); // Position at sides: 90°, 135°, 225°, 270°
                    element.style.transformOrigin = '200px 200px';
                    element.style.transform = `rotate(${angle}deg) scale(0.5)`;
                    element.style.opacity = '0.3';
                    element.style.zIndex = '1';
                    element.classList.remove('focused-pair');
                });
                
                // Add visual connection line between thesis and antithesis
                this.addPairConnectionLine();
                
                // Update controls text
                this.updateControlsText('pair-focused');
                
                // Set smooth transitions
                this.setTransitions();
            }
            
            addPairConnectionLine() {
                // Remove any existing connection line
                this.removePairConnectionLine();
                
                // Create a connection line between center points
                const svg = document.querySelector('.wheel-svg');
                const sliceContainer = document.getElementById('slice-container');
                
                // Create connection line element
                const connectionLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                connectionLine.setAttribute('id', 'pair-connection-line');
                connectionLine.setAttribute('x1', '200');
                connectionLine.setAttribute('y1', '80');  // Top of wheel
                connectionLine.setAttribute('x2', '200');
                connectionLine.setAttribute('y2', '320'); // Bottom of wheel
                connectionLine.setAttribute('stroke', 'rgba(0, 116, 217, 0.4)');
                connectionLine.setAttribute('stroke-width', '2');
                connectionLine.setAttribute('stroke-dasharray', '5,5');
                connectionLine.style.opacity = '0';
                connectionLine.style.transition = 'opacity 0.5s ease-in-out';
                
                // Insert before slice container so it appears behind slices
                svg.insertBefore(connectionLine, sliceContainer);
                
                // Fade in the line
                setTimeout(() => {
                    connectionLine.style.opacity = '1';
                }, 100);
            }
            
            removePairConnectionLine() {
                const existingLine = document.getElementById('pair-connection-line');
                if (existingLine) {
                    existingLine.style.opacity = '0';
                    setTimeout(() => {
                        if (existingLine.parentNode) {
                            existingLine.parentNode.removeChild(existingLine);
                        }
                    }, 500);
                }
            }
            
            reset() {
                this.enlargedPair = null;
                this.currentState = 'normal';
                this.clearHighlights();
                
                // Remove connection line
                this.removePairConnectionLine();
                
                // Reset controls text
                this.updateControlsText('normal');
                
                // Clear animations first
                this.clearAnimations();
                
                const sliceComponents = document.querySelectorAll('.slice-component');
                sliceComponents.forEach((slice, index) => {
                    const mapping = this.sliceMapping[index];
                    // Reset to original thesis-antithesis positioning
                    slice.style.transformOrigin = '200px 200px';
                    slice.style.transform = `rotate(${mapping.baseAngle}deg)`;
                    slice.style.opacity = '1';
                    slice.style.zIndex = '0';
                    // Remove focused pair highlighting
                    slice.classList.remove('focused-pair');
                });
                
                // Set smooth transitions
                this.setTransitions();
            }
            
            clearAnimations() {
                const sliceComponents = document.querySelectorAll('.slice-component');
                sliceComponents.forEach(slice => {
                    slice.style.transition = 'none';
                });
            }
            
            setTransitions() {
                // Add transitions back after a brief moment to avoid conflicts
                setTimeout(() => {
                    const sliceComponents = document.querySelectorAll('.slice-component');
                    sliceComponents.forEach(slice => {
                        slice.style.transition = 'all 0.6s cubic-bezier(0.4, 0.0, 0.2, 1)';
                    });
                }, 50);
            }
        }
        
        // Initialize wheel
        const dialecticalWheel = new DialecticalWheel();
        
        // Global reset function
        function resetSlices() {
            dialecticalWheel.reset();
        }

        // Existing rotation and zoom functionality
        const record = document.querySelector('.record');
        let rotation = 0;
        let isDragging = false;
        let startAngle = 0;
        let startRotation = 0;
        let scale = 1;
        let startScale = 1;
        let isPinching = false;
        let pinchStartDist = 0;
        let offsetX = 0;
        let offsetY = 0;
        let startOffsetX = 0;
        let startOffsetY = 0;
        let pinchMidStart = {x: 200, y: 200};

        function getCenter(el) {
            const rect = el.getBoundingClientRect();
            return {
                x: rect.left + rect.width / 2,
                y: rect.top + rect.height / 2
            };
        }

        function clientToSvg(svg, clientX, clientY) {
            const pt = svg.createSVGPoint();
            pt.x = clientX;
            pt.y = clientY;
            return pt.matrixTransform(svg.getScreenCTM().inverse());
        }

        function setTransform() {
            record.setAttribute('transform', `translate(${offsetX} ${offsetY}) translate(200 200) scale(${scale}) rotate(${rotation}) translate(-200 -200)`);
        }

        record.addEventListener('mousedown', (e) => {
            if (e.touches && e.touches.length > 1) return;
            if (e.target.classList.contains('clickable-slice')) return;
            
            isDragging = true;
            const center = getCenter(record.closest('svg'));
            startAngle = Math.atan2(e.clientY - center.y, e.clientX - center.x);
            startRotation = rotation;
            document.body.style.userSelect = 'none';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging || isPinching) return;
            const center = getCenter(record.closest('svg'));
            const currentAngle = Math.atan2(e.clientY - center.y, e.clientX - center.x);
            let angleDiff = currentAngle - startAngle;
            if (angleDiff > Math.PI) angleDiff -= 2 * Math.PI;
            if (angleDiff < -Math.PI) angleDiff += 2 * Math.PI;
            rotation = startRotation + (angleDiff * (180 / Math.PI));
            setTransform();
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            document.body.style.userSelect = '';
        });

        // Touch support for mobile
        record.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (e.touches.length === 2) {
                isPinching = true;
                isDragging = false;
                pinchStartDist = Math.hypot(
                    e.touches[0].clientX - e.touches[1].clientX,
                    e.touches[0].clientY - e.touches[1].clientY
                );
                startScale = scale;
                const svg = record.closest('svg');
                const midClientX = (e.touches[0].clientX + e.touches[1].clientX) / 2;
                const midClientY = (e.touches[0].clientY + e.touches[1].clientY) / 2;
                pinchMidStart = clientToSvg(svg, midClientX, midClientY);
                startOffsetX = offsetX;
                startOffsetY = offsetY;
            } else if (e.touches.length === 1) {
                const touch = e.touches[0];
                const target = document.elementFromPoint(touch.clientX, touch.clientY);
                if (target && target.classList.contains('clickable-slice')) return;
                
                isDragging = true;
                isPinching = false;
                const center = getCenter(record.closest('svg'));
                startAngle = Math.atan2(touch.clientY - center.y, touch.clientX - center.x);
                startRotation = rotation;
            }
            document.body.style.userSelect = 'none';
        });

        record.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (isPinching && e.touches.length === 2) {
                const dist = Math.hypot(
                    e.touches[0].clientX - e.touches[1].clientX,
                    e.touches[0].clientY - e.touches[1].clientY
                );
                let newScale = startScale * (dist / pinchStartDist);
                newScale = Math.max(1, Math.min(newScale, 3));
                const center = {x: 200, y: 200};
                offsetX = startOffsetX + (pinchMidStart.x - center.x) * (1 - newScale / startScale);
                offsetY = startOffsetY + (pinchMidStart.y - center.y) * (1 - newScale / startScale);
                if (newScale === 1) {
                    offsetX = 0;
                    offsetY = 0;
                }
                scale = newScale;
                setTransform();
            } else if (isDragging && e.touches.length === 1) {
                const touch = e.touches[0];
                const center = getCenter(record.closest('svg'));
                const currentAngle = Math.atan2(touch.clientY - center.y, touch.clientX - center.x);
                let angleDiff = currentAngle - startAngle;
                if (angleDiff > Math.PI) angleDiff -= 2 * Math.PI;
                if (angleDiff < -Math.PI) angleDiff += 2 * Math.PI;
                rotation = startRotation + (angleDiff * (180 / Math.PI));
                setTransform();
            }
        }, { passive: false });

        document.addEventListener('touchend', (e) => {
            if (e.touches.length === 0) {
                isDragging = false;
                isPinching = false;
                document.body.style.userSelect = '';
            }
        });

        // Initial transform
        setTransform();
    </script>
</body>
</html>
